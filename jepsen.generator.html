<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jepsen.generator documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jepsen</span> <span class="project-version">0.1.19</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jepsen</span></div></div></li><li class="depth-2 branch"><a href="jepsen.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-2"><a href="jepsen.checker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clock</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.perf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>perf</span></div></a></li><li class="depth-3"><a href="jepsen.checker.timeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timeline</span></div></a></li><li class="depth-2 branch"><a href="jepsen.cli.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="jepsen.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="jepsen.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2"><a href="jepsen.control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.docker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>docker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.net.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.control.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="jepsen.core.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="jepsen.faketime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faketime</span></div></a></li><li class="depth-2 current"><a href="jepsen.generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generator</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.interpreter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interpreter</span></div></a></li><li class="depth-3"><a href="jepsen.generator.pure.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pure</span></div></a></li><li class="depth-2 branch"><a href="jepsen.independent.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>independent</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nemesis</span></div></a></li><li class="depth-3 branch"><a href="jepsen.nemesis.combined.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>combined</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="jepsen.net.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.net.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="jepsen.os.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>os</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.centos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>centos</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.debian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debian</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.smartos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smartos</span></div></a></li><li class="depth-3"><a href="jepsen.os.ubuntu.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ubuntu</span></div></a></li><li class="depth-2 branch"><a href="jepsen.reconnect.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>reconnect</span></div></a></li><li class="depth-2 branch"><a href="jepsen.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="jepsen.report.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></a></li><li class="depth-2 branch"><a href="jepsen.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-2"><a href="jepsen.tests.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.bank.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bank</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal-reverse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-reverse</span></div></a></li><li class="depth-3"><a href="jepsen.tests.cycle.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cycle</span></div></a></li><li class="depth-4 branch"><a href="jepsen.tests.cycle.append.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>append</span></div></a></li><li class="depth-4"><a href="jepsen.tests.cycle.wr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wr</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.linearizable-register.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>linearizable-register</span></div></a></li><li class="depth-3"><a href="jepsen.tests.long-fork.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>long-fork</span></div></a></li><li class="depth-2 branch"><a href="jepsen.util.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="jepsen.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jepsen.generator.html#var-*threads*"><div class="inner"><span>*threads*</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-await"><div class="inner"><span>await</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-barrier"><div class="inner"><span>barrier</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-cas"><div class="inner"><span>cas</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-clients"><div class="inner"><span>clients</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-concat"><div class="inner"><span>concat</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-defgenerator"><div class="inner"><span>defgenerator</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-delay"><div class="inner"><span>delay</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-delay-fn"><div class="inner"><span>delay-fn</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-delay-til"><div class="inner"><span>delay-til</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-derefer"><div class="inner"><span>derefer</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-drain-queue"><div class="inner"><span>drain-queue</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-each"><div class="inner"><span>each</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-each-"><div class="inner"><span>each-</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-f-map"><div class="inner"><span>f-map</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-filter"><div class="inner"><span>filter</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-flip-flop"><div class="inner"><span>flip-flop</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-gen-type"><div class="inner"><span>gen-type</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-gen-type-"><div class="inner"><span>gen-type-</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-Generator"><div class="inner"><span>Generator</span></div></a></li><li class="depth-2"><a href="jepsen.generator.html#var-op"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>op</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-gens-type"><div class="inner"><span>gens-type</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-limit"><div class="inner"><span>limit</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-log"><div class="inner"><span>log</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-log*"><div class="inner"><span>log*</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-map"><div class="inner"><span>map</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-mix"><div class="inner"><span>mix</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-mix-"><div class="inner"><span>mix-</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-nemesis"><div class="inner"><span>nemesis</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-next-tick-nanos"><div class="inner"><span>next-tick-nanos</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-on"><div class="inner"><span>on</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-once"><div class="inner"><span>once</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-op-and-validate"><div class="inner"><span>op-and-validate</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-phases"><div class="inner"><span>phases</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-process-.3Enode"><div class="inner"><span>process-&gt;node</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-process-.3Ethread"><div class="inner"><span>process-&gt;thread</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-process-limit"><div class="inner"><span>process-limit</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-pure.3F"><div class="inner"><span>pure?</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-queue"><div class="inner"><span>queue</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-reserve"><div class="inner"><span>reserve</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-seq"><div class="inner"><span>seq</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-seq-all"><div class="inner"><span>seq-all</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-singlethreaded"><div class="inner"><span>singlethreaded</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-sleep"><div class="inner"><span>sleep</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-sleep-nanos"><div class="inner"><span>sleep-nanos</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-sleep-til-nanos"><div class="inner"><span>sleep-til-nanos</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-stagger"><div class="inner"><span>stagger</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-start-stop"><div class="inner"><span>start-stop</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-stateful.2Bpure"><div class="inner"><span>stateful+pure</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-stateful.3F"><div class="inner"><span>stateful?</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-synchronize"><div class="inner"><span>synchronize</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-then"><div class="inner"><span>then</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-time-limit"><div class="inner"><span>time-limit</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-void"><div class="inner"><span>void</span></div></a></li><li class="depth-1"><a href="jepsen.generator.html#var-with-threads"><div class="inner"><span>with-threads</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jepsen.generator</h1><div class="doc"><div class="markdown"><p>Generates operations for a test. Generators are composable, stateful objects which emit operations for processes until they are exhausted, at which point they return nil. Generators may sleep when generating operations, to delay the rate at which the test proceeds</p>
<p>Generators do <em>not</em> have to emit a :process for their operations; test workers will take care of that.</p>
<p>Every object may act as a generator, and constantly yields itself.</p>
<p>Big ol box of monads, really.</p></div></div><div class="public anchor" id="var-*threads*"><h3>*threads*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>The ordered collection of threads which will execute a particular generator. The special thread :nemesis is used for the nemesis; other threads are 0-n, where n is the test concurrency. Processes map to threads: process mod n is the thread ID.</p>
<p>The set of threads is used where multiple parts of a test must synchronize.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L126">view source</a></div></div><div class="public anchor" id="var-await"><h3>await</h3><div class="usage"><code>(await f)</code><code>(await f gen)</code></div><div class="doc"><div class="markdown"><p>Blocks until the given fn returns, then allows [gen] to proceed. If no gen is given, yields nil. Only invokes fn once.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L781">view source</a></div></div><div class="public anchor" id="var-barrier"><h3>barrier</h3><div class="usage"><code>(barrier gen)</code></div><div class="doc"><div class="markdown"><p>When the given generator completes, synchronizes, then yields nil.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L830">view source</a></div></div><div class="public anchor" id="var-cas"><h3>cas</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Random cas/read ops for a compare-and-set register over a small field of integers.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L470">view source</a></div></div><div class="public anchor" id="var-clients"><h3>clients</h3><div class="usage"><code>(clients client-gen)</code></div><div class="doc"><div class="markdown"><p>Executes generator only on clients.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L766">view source</a></div></div><div class="public anchor" id="var-concat"><h3>concat</h3><div class="usage"><code>(concat &amp; sources)</code></div><div class="doc"><div class="markdown"><p>Takes n generators and yields the first non-nil operation from any, in order.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L750">view source</a></div></div><div class="public anchor" id="var-defgenerator"><h3>defgenerator</h3><h4 class="type">macro</h4><div class="usage"><code>(defgenerator name fields print-forms &amp; protocols-and-functions)</code></div><div class="doc"><div class="markdown"><p>Like deftype, but the fields spec is followed by a vector of expressions which are used to print the datatype, and the Generator protocol is implicit. For instance:</p>
<pre><code>(defgenerator Delay [dt]
  [(str dt " seconds")] ; For pretty-printing
  (op [this test process] ; Function body
    ...))
</code></pre>
<p>Inside the print-forms vector, every occurrence of a field name is replaced by (.some-field a-generator), so don’t get fancy with let bindings or anything.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L162">view source</a></div></div><div class="public anchor" id="var-delay"><h3>delay</h3><div class="usage"><code>(delay dt gen)</code></div><div class="doc"><div class="markdown"><p>Every operation from the underlying generator takes dt seconds to return.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L257">view source</a></div></div><div class="public anchor" id="var-delay-fn"><h3>delay-fn</h3><div class="usage"><code>(delay-fn f gen)</code></div><div class="doc"><div class="markdown"><p>Every operation from the underlying generator takes (f) seconds longer.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L252">view source</a></div></div><div class="public anchor" id="var-delay-til"><h3>delay-til</h3><div class="usage"><code>(delay-til dt gen)</code><code>(delay-til dt precache? gen)</code></div><div class="doc"><div class="markdown"><p>Operations are emitted as close as possible to multiples of dt seconds from some epoch. Where <code>delay</code> introduces a fixed delay between completion and invocation, delay-til attempts to schedule invocations as close as possible to the same time. This is useful for triggering race conditions.</p>
<p>If precache? is true (the default), will pre-emptively request the next operation from the underlying generator, to eliminate jitter from that generator.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L296">view source</a></div></div><div class="public anchor" id="var-derefer"><h3>derefer</h3><div class="usage"><code>(derefer dgen)</code></div><div class="doc"><div class="markdown"><p>Sometimes you need to build a generator not <em>now</em>, but <em>later</em>; e.g. because it depends on state that won’t be available until the generator is actually invoked. Wrap a derefable returning a generator in this, and it’ll be deref’ed every time an op is requested. For instance:</p>
<pre><code>(derefer (delay (gen/once {:type :drain-key, :value @key})))
</code></pre>
<p>Looks up the key to drain only once an operation is requested.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L330">view source</a></div></div><div class="public anchor" id="var-drain-queue"><h3>drain-queue</h3><div class="usage"><code>(drain-queue gen)</code></div><div class="doc"><div class="markdown"><p>Wraps a generator, and keeps track of the balance of :enqueue and :dequeue operations that pass through. When the underlying generator is exhausted, emits enough :dequeue operations to dequeue every attempted enqueue.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L498">view source</a></div></div><div class="public anchor" id="var-each"><h3>each</h3><h4 class="type">macro</h4><div class="usage"><code>(each gen-expr)</code></div><div class="doc"><div class="markdown"><p>Takes an expression evaluating to a generator. Captures that expression as a function, and constructs a generator that invokes that expression once for each process, as new processes arrive, such that each process sees an independent copy of the underlying generator.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L377">view source</a></div></div><div class="public anchor" id="var-each-"><h3>each-</h3><div class="usage"><code>(each- gen-fn)</code></div><div class="doc"><div class="markdown"><p>Takes a function that yields a generator. Invokes that function to create a new generator for each distinct process.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L371">view source</a></div></div><div class="public anchor" id="var-f-map"><h3>f-map</h3><div class="usage"><code>(f-map f-map g)</code></div><div class="doc"><div class="markdown"><p>Takes a function <code>f-map</code> converting op functions (:f op) to other functions, and a generator <code>g</code>. Returns a generator like <code>g</code>, but where fs are replaced according to <code>f-map</code>. Useful for composing generators together for use with a composed nemesis.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L227">view source</a></div></div><div class="public anchor" id="var-filter"><h3>filter</h3><div class="usage"><code>(filter f gen)</code></div><div class="doc"><div class="markdown"><p>Takes a generator and yields a generator which emits only operations satisfying <code>(f op)</code>.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L665">view source</a></div></div><div class="public anchor" id="var-flip-flop"><h3>flip-flop</h3><div class="usage"><code>(flip-flop a b)</code></div><div class="doc"><div class="markdown"><p>Alternates between operations from two generators: a, b, a, b, …</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L835">view source</a></div></div><div class="public anchor" id="var-gen-type"><h3>gen-type</h3><div class="usage"><code>(gen-type x)</code></div><div class="doc"><div class="markdown"><p>Returns :stateful, :pure, :both, or nil, based on what the given generator can definitely support while remaining compatible with stateful generators. For instance, functions are both stateful and pure generators, but their behavior is incompatible, so we only consider them as stateful generators for now.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L74">view source</a></div></div><div class="public anchor" id="var-gen-type-"><h3>gen-type-</h3><div class="usage"><code>(gen-type- x)</code></div><div class="doc"><div class="markdown"><p>Returns :stateful, :pure, :both, or nil, based on what the given generator supports.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L62">view source</a></div></div><div class="public anchor" id="var-Generator"><h3>Generator</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-op"><h3>op</h3><div class="usage"><code>(op gen test process)</code></div><div class="doc"><div class="markdown"><p>Yields an operation to apply.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L29">view source</a></div></div><div class="public anchor" id="var-gens-type"><h3>gens-type</h3><div class="usage"><code>(gens-type gens)</code></div><div class="doc"><div class="markdown"><p>Given a collection of generators, returns :stateful if they’re all stateful generators, :pure if they’re all pure generators, and :both if they’re all both. Throws if there’s a mix.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L86">view source</a></div></div><div class="public anchor" id="var-limit"><h3>limit</h3><div class="usage"><code>(limit n gen)</code></div><div class="doc"><div class="markdown"><p>Takes a generator and returns a generator which only produces n operations.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L521">view source</a></div></div><div class="public anchor" id="var-log"><h3>log</h3><div class="usage"><code>(log msg)</code></div><div class="doc"><div class="markdown"><p>Logs a message only once, and yields nil.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L353">view source</a></div></div><div class="public anchor" id="var-log*"><h3>log*</h3><div class="usage"><code>(log* msg)</code></div><div class="doc"><div class="markdown"><p>Logs a message every time invoked, and yields nil.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L348">view source</a></div></div><div class="public anchor" id="var-map"><h3>map</h3><div class="usage"><code>(map f g)</code></div><div class="doc"><div class="markdown"><p>A generator which wraps another generator g, transforming operations it generates with (f op test process), of if that fails, (f op). When the underlying generator yields nil, this generator also returns nil.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L220">view source</a></div></div><div class="public anchor" id="var-mix"><h3>mix</h3><div class="usage"><code>(mix gens)</code></div><div class="doc"><div class="markdown"><p>A random mixture of operations. Takes a collection of generators and chooses between them uniformly. If the collection is empty, generator returns nil.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L459">view source</a></div></div><div class="public anchor" id="var-mix-"><h3>mix-</h3><div class="usage"><code>(mix- gens)</code></div><div class="doc"><div class="markdown"><p>A random mixture of operations. Takes a collection of generators and chooses between them uniformly. If the collection is empty, generator returns nil.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L450">view source</a></div></div><div class="public anchor" id="var-nemesis"><h3>nemesis</h3><div class="usage"><code>(nemesis nemesis-gen)</code><code>(nemesis nemesis-gen client-gen)</code></div><div class="doc"><div class="markdown"><p>Combines a generator of normal operations and a generator for nemesis operations into one. When the process requesting an operation is :nemesis, routes to the nemesis generator; otherwise to the normal generator.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L756">view source</a></div></div><div class="public anchor" id="var-next-tick-nanos"><h3>next-tick-nanos</h3><div class="usage"><code>(next-tick-nanos anchor dt)</code><code>(next-tick-nanos anchor dt now)</code></div><div class="doc"><div class="markdown"><p>Given a period <code>dt</code> (in nanos), beginning at some point in time <code>anchor</code> (also in nanos), finds the next tick after time <code>now</code>, such that the next tick is separate from anchor by an exact multiple of dt. If now is omitted, defaults to the current time.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L275">view source</a></div></div><div class="public anchor" id="var-on"><h3>on</h3><div class="usage"><code>(on f source)</code></div><div class="doc"><div class="markdown"><p>Forwards operations to source generator iff (f thread) is true. Rebinds <em>threads</em> appropriately.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L678">view source</a></div></div><div class="public anchor" id="var-once"><h3>once</h3><div class="usage"><code>(once source)</code></div><div class="doc"><div class="markdown"><p>Wraps another generator, invoking it only once.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L319">view source</a></div></div><div class="public anchor" id="var-op-and-validate"><h3>op-and-validate</h3><div class="usage"><code>(op-and-validate gen test process)</code></div><div class="doc"><div class="markdown"><p>Wraps <code>op</code> to ensure we produce a valid operation for our worker. Re-throws any exception we catch from the generator.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L100">view source</a></div></div><div class="public anchor" id="var-phases"><h3>phases</h3><div class="usage"><code>(phases &amp; generators)</code></div><div class="doc"><div class="markdown"><p>Like concat, but requires that all threads finish the first generator before moving to the second, and so on.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L808">view source</a></div></div><div class="public anchor" id="var-process-.3Enode"><h3>process-&gt;node</h3><div class="usage"><code>(process-&gt;node test process)</code></div><div class="doc"><div class="markdown"><p>Given a test and a process identifier, returns the corresponding node this process is likely (clients aren’t required to respect the node they’re given) talking to, if process is an integer. Otherwise, nil.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L151">view source</a></div></div><div class="public anchor" id="var-process-.3Ethread"><h3>process-&gt;thread</h3><div class="usage"><code>(process-&gt;thread test process)</code></div><div class="doc"><div class="markdown"><p>Given a process identifier, return the corresponding thread identifier.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L144">view source</a></div></div><div class="public anchor" id="var-process-limit"><h3>process-limit</h3><div class="usage"><code>(process-limit n gen)</code></div><div class="doc"><div class="markdown"><p>Takes a generator and returns a generator with bounded concurrency–it emits operations for up to n distinct processes, but no more. Once n+1 processes have requested an operation, emits nil forever.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L532">view source</a></div></div><div class="public anchor" id="var-pure.3F"><h3>pure?</h3><div class="usage"><code>(pure? x)</code></div><div class="doc"><div class="markdown"><p>Can this object be considered a pure generator?</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L57">view source</a></div></div><div class="public anchor" id="var-queue"><h3>queue</h3><div class="usage"><code>(queue)</code></div><div class="doc"><div class="markdown"><p>A random mix of enqueue/dequeue operations over consecutive integers.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L485">view source</a></div></div><div class="public anchor" id="var-reserve"><h3>reserve</h3><div class="usage"><code>(reserve &amp; args)</code></div><div class="doc"><div class="markdown"><p>Takes a series of count, generator pairs, and a final default generator.</p>
<pre><code>(reserve 5 write 10 cas read)
</code></pre>
<p>The first 5 threads will call the <code>write</code> generator, the next 10 will emit CAS operations, and the remaining threads will perform reads. This is particularly useful when you want to ensure that two classes of operations have a chance to proceed concurrently–for instance, if writes begin blocking, you might like reads to proceed concurrently without every thread getting tied up in a write.</p>
<p>Rebinds <em>threads</em> appropriately. Assumes that every invocation of this generator arrives with the same binding for <em>threads</em>.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L703">view source</a></div></div><div class="public anchor" id="var-seq"><h3>seq</h3><div class="usage"><code>(seq coll)</code></div><div class="doc"><div class="markdown"><p>Given a sequence of generators, emits one operation from the first, then one from the second, then one from the third, etc. If a generator yields nil, immediately moves to the next. Yields nil once coll is exhausted.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L397">view source</a></div></div><div class="public anchor" id="var-seq-all"><h3>seq-all</h3><div class="usage"><code>(seq-all coll)</code></div><div class="doc"><div class="markdown"><p>Given a sequence of generators, emits all operations from the first, then all operations from the second, then all from the third, etc. If a generator yields nil, immediately moves to the next. Yields nil once all generators in coll are exhausted.</p>
<p>Be aware that providing an infinite sequence of generators to seq-all may result in an infinite loop, if every generator returns <code>nil</code> immediately. Ensure that at least some, if not all, generators in an infinite sequence actually return operations. You <em>don’t</em> want to seq-all over an infinite sequence of the same stateful, limited generators; when those generators are exhausted, you’ll create an infinite loop going through each of them, obtaining <code>nil</code>, and moving to the next.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L420">view source</a></div></div><div class="public anchor" id="var-singlethreaded"><h3>singlethreaded</h3><div class="usage"><code>(singlethreaded gen)</code></div><div class="doc"><div class="markdown"><p>Obtaining an operation from the underlying generator requires an exclusive lock. TODO: is this actually used by anyone? Feels kind of silly given everythng else is concurrency-safe.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L820">view source</a></div></div><div class="public anchor" id="var-sleep"><h3>sleep</h3><div class="usage"><code>(sleep dt)</code></div><div class="doc"><div class="markdown"><p>Takes dt seconds, and always produces a nil.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L263">view source</a></div></div><div class="public anchor" id="var-sleep-nanos"><h3>sleep-nanos</h3><div class="usage"><code>(sleep-nanos dt)</code></div><div class="doc"><div class="markdown"><p>High-resolution sleep; takes a (possibly fractional) time in nanos.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L241">view source</a></div></div><div class="public anchor" id="var-sleep-til-nanos"><h3>sleep-til-nanos</h3><div class="usage"><code>(sleep-til-nanos t)</code></div><div class="doc"><div class="markdown"><p>High-resolution sleep; takes a time in nanos, relative to System/nanotime.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L235">view source</a></div></div><div class="public anchor" id="var-stagger"><h3>stagger</h3><div class="usage"><code>(stagger dt gen)</code></div><div class="doc"><div class="markdown"><p>Introduces uniform random timing noise with a mean delay of dt seconds for every operation. Delays range from 0 to 2 * dt.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L268">view source</a></div></div><div class="public anchor" id="var-start-stop"><h3>start-stop</h3><div class="usage"><code>(start-stop t1 t2)</code></div><div class="doc"><div class="markdown"><p>A generator which emits a start after a t1 second delay, and then a stop after a t2 second delay.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L436">view source</a></div></div><div class="public anchor" id="var-stateful.2Bpure"><h3>stateful+pure</h3><div class="usage"><code>(stateful+pure stateful pure)</code></div><div class="doc"><div class="markdown"><p>A wrapper which combines a stateful generator and a pure generator (hopefully with the same semantics) into one package. For pure generators, this wrapper disappears as soon as ops/updates occur.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L45">view source</a></div></div><div class="public anchor" id="var-stateful.3F"><h3>stateful?</h3><div class="usage"><code>(stateful? x)</code></div><div class="doc"><div class="markdown"><p>Can this object be considered a stateful generator?</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L52">view source</a></div></div><div class="public anchor" id="var-synchronize"><h3>synchronize</h3><div class="usage"><code>(synchronize gen)</code></div><div class="doc"><div class="markdown"><p>Blocks until all nodes are blocked awaiting operations from this generator, then allows them to proceed. Only synchronizes a single time; subsequent operations on this generator proceed freely.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L801">view source</a></div></div><div class="public anchor" id="var-then"><h3>then</h3><div class="usage"><code>(then a b)</code></div><div class="doc"><div class="markdown"><p>Generator B, synchronize, then generator A. Why is this backwards? Because it reads better in -&gt;&gt; composition.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L814">view source</a></div></div><div class="public anchor" id="var-time-limit"><h3>time-limit</h3><div class="usage"><code>(time-limit dt source)</code></div><div class="doc"><div class="markdown"><p>Yields operations from the underlying generator until dt seconds have elapsed.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L650">view source</a></div></div><div class="public anchor" id="var-void"><h3>void</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A generator which terminates immediately</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L208">view source</a></div></div><div class="public anchor" id="var-with-threads"><h3>with-threads</h3><h4 class="type">macro</h4><div class="usage"><code>(with-threads threads &amp; body)</code></div><div class="doc"><div class="markdown"><p>Binds <em>threads</em> for duration of body. Safety check: asserts threads are sorted.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.19/jepsen/src/jepsen/generator.clj#L135">view source</a></div></div></div></body></html>