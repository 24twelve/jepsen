<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jepsen.tests.cycle documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jepsen</span> <span class="project-version">0.1.17</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jepsen</span></div></div></li><li class="depth-2 branch"><a href="jepsen.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-2"><a href="jepsen.checker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clock</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.perf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>perf</span></div></a></li><li class="depth-3"><a href="jepsen.checker.timeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timeline</span></div></a></li><li class="depth-2 branch"><a href="jepsen.cli.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="jepsen.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="jepsen.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2"><a href="jepsen.control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.net.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.control.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="jepsen.core.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="jepsen.faketime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faketime</span></div></a></li><li class="depth-2"><a href="jepsen.generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generator</span></div></a></li><li class="depth-3"><a href="jepsen.generator.pure.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pure</span></div></a></li><li class="depth-2 branch"><a href="jepsen.independent.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>independent</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nemesis</span></div></a></li><li class="depth-3 branch"><a href="jepsen.nemesis.combined.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>combined</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="jepsen.net.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.net.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="jepsen.os.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>os</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.centos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>centos</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.debian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debian</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.smartos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smartos</span></div></a></li><li class="depth-3"><a href="jepsen.os.ubuntu.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ubuntu</span></div></a></li><li class="depth-2 branch"><a href="jepsen.reconnect.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>reconnect</span></div></a></li><li class="depth-2 branch"><a href="jepsen.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="jepsen.report.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></a></li><li class="depth-2 branch"><a href="jepsen.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-2"><a href="jepsen.tests.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.bank.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bank</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal-reverse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-reverse</span></div></a></li><li class="depth-3 current"><a href="jepsen.tests.cycle.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cycle</span></div></a></li><li class="depth-4"><a href="jepsen.tests.cycle.append.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>append</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.linearizable-register.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>linearizable-register</span></div></a></li><li class="depth-3"><a href="jepsen.tests.long-fork.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>long-fork</span></div></a></li><li class="depth-2 branch"><a href="jepsen.util.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="jepsen.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jepsen.tests.cycle.html#var--.3Ebset"><div class="inner"><span>-&gt;bset</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-check"><div class="inner"><span>check</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-checker"><div class="inner"><span>checker</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-combine"><div class="inner"><span>combine</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-cycle-explainer"><div class="inner"><span>cycle-explainer</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-CycleExplainer"><div class="inner"><span>CycleExplainer</span></div></a></li><li class="depth-2 branch"><a href="jepsen.tests.cycle.html#var-explain-cycle"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>explain-cycle</span></div></a></li><li class="depth-2"><a href="jepsen.tests.cycle.html#var-render-cycle-explanation"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>render-cycle-explanation</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-DataExplainer"><div class="inner"><span>DataExplainer</span></div></a></li><li class="depth-2 branch"><a href="jepsen.tests.cycle.html#var-explain-pair-data"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>explain-pair-data</span></div></a></li><li class="depth-2"><a href="jepsen.tests.cycle.html#var-render-explanation"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>render-explanation</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-digraph-union"><div class="inner"><span>digraph-union</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-directed-graph"><div class="inner"><span>directed-graph</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-edge"><div class="inner"><span>edge</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-edges"><div class="inner"><span>edges</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-explain-binding"><div class="inner"><span>explain-binding</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-explain-cycle-ops"><div class="inner"><span>explain-cycle-ops</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-explain-cycle-pair-data"><div class="inner"><span>explain-cycle-pair-data</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-explain-pair"><div class="inner"><span>explain-pair</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-explain-scc"><div class="inner"><span>explain-scc</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-ext-index"><div class="inner"><span>ext-index</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-find-cycle"><div class="inner"><span>find-cycle</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-find-cycle-starting-with"><div class="inner"><span>find-cycle-starting-with</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-forked"><div class="inner"><span>forked</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-grow-paths"><div class="inner"><span>grow-paths</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-in"><div class="inner"><span>in</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-keep-edge-values"><div class="inner"><span>keep-edge-values</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-linear"><div class="inner"><span>linear</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-link"><div class="inner"><span>link</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-link-all-to"><div class="inner"><span>link-all-to</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-link-all-to-all"><div class="inner"><span>link-all-to-all</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-link-to-all"><div class="inner"><span>link-to-all</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-loop.3F"><div class="inner"><span>loop?</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-map-.3Ebdigraph"><div class="inner"><span>map-&gt;bdigraph</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-monotonic-key-graph"><div class="inner"><span>monotonic-key-graph</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-monotonic-key-order"><div class="inner"><span>monotonic-key-order</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-path-shells"><div class="inner"><span>path-shells</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-process-graph"><div class="inner"><span>process-graph</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-process-order"><div class="inner"><span>process-order</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-project-relationship"><div class="inner"><span>project-relationship</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-prune-alternate-paths"><div class="inner"><span>prune-alternate-paths</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-prune-longer-paths"><div class="inner"><span>prune-longer-paths</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-realtime-graph"><div class="inner"><span>realtime-graph</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-remove-relationship"><div class="inner"><span>remove-relationship</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-renumber-graph"><div class="inner"><span>renumber-graph</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-strongly-connected-components"><div class="inner"><span>strongly-connected-components</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-tarjan"><div class="inner"><span>tarjan</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-ToClj"><div class="inner"><span>ToClj</span></div></a></li><li class="depth-2"><a href="jepsen.tests.cycle.html#var--.3Eclj"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>-&gt;clj</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-union-edge"><div class="inner"><span>union-edge</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-unlink"><div class="inner"><span>unlink</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-wr-graph"><div class="inner"><span>wr-graph</span></div></a></li><li class="depth-1"><a href="jepsen.tests.cycle.html#var-write-cycles.21"><div class="inner"><span>write-cycles!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jepsen.tests.cycle</h1><div class="doc"><div class="markdown"><p>Tests based on detecting cycles between operations in a history.</p>
<p>First, we define a bunch of ways you can compute a dependency graph over a history. Our graphs use completions (e.g. ok, info) for the canonical representation of an operation. For instance:</p>
<p><code>realtime-graph</code> relates a-&gt;b if operation b begins after operation a completes successfully.</p>
<p><code>process-graph</code> relates a-&gt;b if a and b are performed by the same process, and that process executes a before b.</p>
<p><code>monotonic-key-graph</code> assumes op :values are maps of keys to observed values, like {:x 1 :y 2}. It relates a-&gt;b if b observed a higher value of some key than a did. For instance, {:x 1 :y 2} -&gt; {:x 2 :y 2}, because :x is higher in the second op.</p>
<p><code>wr-graph</code> assumes op :values are transactions like [[f k v] …], and relates operations based on transactional reads and writes: a-&gt;b if b observes a value that a wrote. This order requires that keys only have a given value written once.</p>
<p>You can also <em>combine</em> graphs using <code>combine</code>, which takes the union of multiple graphs. <code>(combine realtime monotonic-key)</code>, for instance, verifies that not only must the values of each key monotonically increase, but that those increases must be observed in real time: stale reads are not allowed.</p>
<p>Given a function which takes a history and produces a dependency graph, the checker runs that function, identifies strongly-connected components in the resulting graph, and decides whether the history is valid based on whether the graph has any strongly connected components–e.g. cycles.</p></div></div><div class="public anchor" id="var--.3Ebset"><h3>-&gt;bset</h3><div class="usage"><code>(-&gt;bset coll)</code><code>(-&gt;bset coll s)</code></div><div class="doc"><div class="markdown"><p>Turns any collection into a Bifurcan Set.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L234">view source</a></div></div><div class="public anchor" id="var-check"><h3>check</h3><div class="usage"><code>(check analyze-fn history)</code></div><div class="doc"><div class="markdown"><p>Meat of the checker. Takes an analysis function and a history; returns a map of:</p>
<pre><code>{:graph     The computed graph
 :explainer The explainer for that graph
 :cycles    A list of cycles we found
 :sccs      A set of strongly connected components}
</code></pre></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L851">view source</a></div></div><div class="public anchor" id="var-checker"><h3>checker</h3><div class="usage"><code>(checker analyze-fn)</code></div><div class="doc"><div class="markdown"><p>Takes a function which takes a history and returns a [graph, explainer] pair, and returns a checker which uses those graphs to identify cyclic dependencies.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L889">view source</a></div></div><div class="public anchor" id="var-combine"><h3>combine</h3><div class="usage"><code>(combine &amp; analyzers)</code></div><div class="doc"><div class="markdown"><p>Helpful in composing an analysis function for a checker out of multiple other analysis fns. For example, you might want a checker that looks for per-key monotonicity <em>and</em> real-time precedence—you could use:</p>
<p>(checker (combine monotonic-keys real-time))</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L340">view source</a></div></div><div class="public anchor" id="var-cycle-explainer"><h3>cycle-explainer</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>This explainer just provides the step-by-step explanation of the relationships between pairs of operations.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L822">view source</a></div></div><div class="public anchor" id="var-CycleExplainer"><h3>CycleExplainer</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-explain-cycle"><h3>explain-cycle</h3><div class="usage"><code>(explain-cycle _ pair-explainer cycle)</code></div><div class="doc"><div class="markdown"><p>Takes a cycle and constructs a data structure describing it.</p></div></div></div><div class="public anchor" id="var-render-cycle-explanation"><h3>render-cycle-explanation</h3><div class="usage"><code>(render-cycle-explanation _ pair-explainer explanation)</code></div><div class="doc"><div class="markdown"><p>Takes an explanation of a cycle and renders it to a string.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L813">view source</a></div></div><div class="public anchor" id="var-DataExplainer"><h3>DataExplainer</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-explain-pair-data"><h3>explain-pair-data</h3><div class="usage"><code>(explain-pair-data _ a b)</code></div><div class="doc"><div class="markdown"><p>Given a pair of operations a and b, explains why b depends on a, in the form of a data structure. Returns <code>nil</code> if b does not depend on a.</p></div></div></div><div class="public anchor" id="var-render-explanation"><h3>render-explanation</h3><div class="usage"><code>(render-explanation _ explanation a-name b-name)</code></div><div class="doc"><div class="markdown"><p>Given an explanation from explain-pair-data, and short names for a and b, renders a string explaining why a depends on b.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L293">view source</a></div></div><div class="public anchor" id="var-digraph-union"><h3>digraph-union</h3><div class="usage"><code>(digraph-union)</code><code>(digraph-union a)</code><code>(digraph-union a b)</code><code>(digraph-union a b &amp; more)</code></div><div class="doc"><div class="markdown"><p>Takes the union of n graphs, merging edges with union.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L243">view source</a></div></div><div class="public anchor" id="var-directed-graph"><h3>directed-graph</h3><div class="usage"><code>(directed-graph)</code></div><div class="doc"><div class="markdown"><p>Constructs a fresh directed graph.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L100">view source</a></div></div><div class="public anchor" id="var-edge"><h3>edge</h3><div class="usage"><code>(edge g a b)</code></div><div class="doc"><div class="markdown"><p>Returns the edge between two vertices.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L127">view source</a></div></div><div class="public anchor" id="var-edges"><h3>edges</h3><div class="usage"><code>(edges g)</code></div><div class="doc"><div class="markdown"><p>A lazy seq of all edges.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L132">view source</a></div></div><div class="public anchor" id="var-explain-binding"><h3>explain-binding</h3><div class="usage"><code>(explain-binding bindings)</code></div><div class="doc"><div class="markdown"><p>Takes a seq of [name op] pairs, and constructs a string naming each op.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L770">view source</a></div></div><div class="public anchor" id="var-explain-cycle-ops"><h3>explain-cycle-ops</h3><div class="usage"><code>(explain-cycle-ops pair-explainer binding steps)</code></div><div class="doc"><div class="markdown"><p>Takes an pair explainer, a binding, and a sequence of steps: each an explanation data structure of one pair. Produces a string explaining why they follow in that order.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L790">view source</a></div></div><div class="public anchor" id="var-explain-cycle-pair-data"><h3>explain-cycle-pair-data</h3><div class="usage"><code>(explain-cycle-pair-data pair-explainer [a b])</code></div><div class="doc"><div class="markdown"><p>Takes a pair explainer and a pair of ops, and constructs a data structure explaining why a precedes b.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L779">view source</a></div></div><div class="public anchor" id="var-explain-pair"><h3>explain-pair</h3><div class="usage"><code>(explain-pair explainer a-name a b-name b)</code></div><div class="doc"><div class="markdown"><p>Given a pair of operations, and short names for them, explain why b depends on a, as a string. <code>nil</code> indicates that b does not depend on a.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L304">view source</a></div></div><div class="public anchor" id="var-explain-scc"><h3>explain-scc</h3><div class="usage"><code>(explain-scc graph cycle-explainer pair-explainer scc)</code></div><div class="doc"><div class="markdown"><p>Takes a graph, a cycle explainer, a pair explainer, and a strongly connected component (a collection of ops) in that graph. Using those graphs, constructs a string explaining the cycle.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L842">view source</a></div></div><div class="public anchor" id="var-ext-index"><h3>ext-index</h3><div class="usage"><code>(ext-index ext-fn history)</code></div><div class="doc"><div class="markdown"><p>Given a function that takes a txn and returns a map of external keys to written values for that txn, and a history, computes a map like {k {v [op1, op2, …]}}, where k is a key, v is a particular value for that key, and op1, op2, … are operations which externally wrote k=v.</p>
<p>Right now we index only :ok ops. Later we should do :infos too, but we need to think carefully about how to interpret the meaning of their nil reads.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L543">view source</a></div></div><div class="public anchor" id="var-find-cycle"><h3>find-cycle</h3><div class="usage"><code>(find-cycle graph scc)</code></div><div class="doc"><div class="markdown"><p>Given a graph and a strongly connected component within it, finds a short cycle in that component.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L752">view source</a></div></div><div class="public anchor" id="var-find-cycle-starting-with"><h3>find-cycle-starting-with</h3><div class="usage"><code>(find-cycle-starting-with initial-graph remaining-graph scc)</code></div><div class="doc"><div class="markdown"><p>Some anomalies consist of a cycle with exactly, or at least, one edge of a particular type. This fuction works like find-cycle, but allows you to pass <em>two</em> graphs: an initial graph, which is used for the first step, and a remaining graph, which is used for later steps.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L705">view source</a></div></div><div class="public anchor" id="var-forked"><h3>forked</h3><div class="usage"><code>(forked graph)</code></div><div class="doc"><div class="markdown"><p>Bifurcan’s analogue to (persistent! g)</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L110">view source</a></div></div><div class="public anchor" id="var-grow-paths"><h3>grow-paths</h3><div class="usage"><code>(grow-paths g paths)</code></div><div class="doc"><div class="markdown"><p>Given a graph g, and a set of paths (each a sequence like [a b c]), constructs a new set of paths by taking the tip c of each path p, and expanding p to all vertices c can reach: [a b c] =&gt; #{[a b c d] [a b c e]}.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L649">view source</a></div></div><div class="public anchor" id="var-in"><h3>in</h3><div class="usage"><code>(in g v)</code></div><div class="doc"><div class="markdown"><p>Inbound edges to a graph.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L115">view source</a></div></div><div class="public anchor" id="var-keep-edge-values"><h3>keep-edge-values</h3><div class="usage"><code>(keep-edge-values f g)</code></div><div class="doc"><div class="markdown"><p>Transforms a graph by applying a function (f edge-value) to each edge in the graph. Where the function returns <code>nil</code>, removes that edge altogether.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L186">view source</a></div></div><div class="public anchor" id="var-linear"><h3>linear</h3><div class="usage"><code>(linear graph)</code></div><div class="doc"><div class="markdown"><p>Bifurcan’s analogue to (transient g)</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L105">view source</a></div></div><div class="public anchor" id="var-link"><h3>link</h3><div class="usage"><code>(link graph node succ)</code><code>(link graph node succ relationship)</code></div><div class="doc"><div class="markdown"><p>Helper for linking Bifurcan graphs. Optionally takes a relationship, which is added to the value set of the edge.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L140">view source</a></div></div><div class="public anchor" id="var-link-all-to"><h3>link-all-to</h3><div class="usage"><code>(link-all-to g xs y)</code><code>(link-all-to g xs y relationship)</code></div><div class="doc"><div class="markdown"><p>Given a graph g, links all xs to y.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L161">view source</a></div></div><div class="public anchor" id="var-link-all-to-all"><h3>link-all-to-all</h3><div class="usage"><code>(link-all-to-all g xs ys)</code><code>(link-all-to-all g xs ys rel)</code></div><div class="doc"><div class="markdown"><p>Given a graph g, links all xs to all ys.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L172">view source</a></div></div><div class="public anchor" id="var-link-to-all"><h3>link-to-all</h3><div class="usage"><code>(link-to-all g x ys)</code><code>(link-to-all g x ys rel)</code></div><div class="doc"><div class="markdown"><p>Given a graph g, links x to all ys.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L152">view source</a></div></div><div class="public anchor" id="var-loop.3F"><h3>loop?</h3><div class="usage"><code>(loop? v)</code></div><div class="doc"><div class="markdown"><p>Does the given vector begin and end with identical elements, and is longer than 1?</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L671">view source</a></div></div><div class="public anchor" id="var-map-.3Ebdigraph"><h3>map-&gt;bdigraph</h3><div class="usage"><code>(map-&gt;bdigraph m)</code></div><div class="doc"><div class="markdown"><p>Turns a sequence of [node, successors] pairs (e.g. a map) into a bifurcan directed graph</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L222">view source</a></div></div><div class="public anchor" id="var-monotonic-key-graph"><h3>monotonic-key-graph</h3><div class="usage"><code>(monotonic-key-graph history)</code></div><div class="doc"><div class="markdown"><p>Analyzes ops where the :value of each op is a map of keys to values. Assumes keys are monotonically increasing, and derives relationships between ops based on those values.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L400">view source</a></div></div><div class="public anchor" id="var-monotonic-key-order"><h3>monotonic-key-order</h3><div class="usage"><code>(monotonic-key-order k history)</code></div><div class="doc"><div class="markdown"><p>Given a key, and a history where ops are maps of keys to values, constructs a partial order graph over ops reading successive values of key k.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L382">view source</a></div></div><div class="public anchor" id="var-path-shells"><h3>path-shells</h3><div class="usage"><code>(path-shells g starting-paths)</code></div><div class="doc"><div class="markdown"><p>Given a graph, and a starting collection of paths, constructs shells outwards from those paths: collections of longer and longer paths.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L660">view source</a></div></div><div class="public anchor" id="var-process-graph"><h3>process-graph</h3><div class="usage"><code>(process-graph history)</code></div><div class="doc"><div class="markdown"><p>Analyses histories and relates operations performed sequentially by each process, such that every operation a process performs is ordered (but operations across different processes are not related).</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L437">view source</a></div></div><div class="public anchor" id="var-process-order"><h3>process-order</h3><div class="usage"><code>(process-order history process)</code></div><div class="doc"><div class="markdown"><p>Given a history and a process ID, constructs a partial order graph based on all operations that process performed.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L415">view source</a></div></div><div class="public anchor" id="var-project-relationship"><h3>project-relationship</h3><div class="usage"><code>(project-relationship g rel)</code></div><div class="doc"><div class="markdown"><p>Filters a graph to just those edges with the given relationship.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L213">view source</a></div></div><div class="public anchor" id="var-prune-alternate-paths"><h3>prune-alternate-paths</h3><div class="usage"><code>(prune-alternate-paths paths)</code></div><div class="doc"><div class="markdown"><p>If we have two paths [a b d] and [a c d], we don’t need both of them, because both get us from a to d. We collapse a set of paths by filtering out duplicates. Since all paths <em>start</em> at the same place, we can do this efficiently by selecting one from the set of all paths that end in the same place.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L627">view source</a></div></div><div class="public anchor" id="var-prune-longer-paths"><h3>prune-longer-paths</h3><div class="usage"><code>(prune-longer-paths paths)</code></div><div class="doc"><div class="markdown"><p>We can also completely remove paths whose tips are in a prefix of any other path, because these paths are simply longer versions of paths we’ve already explored.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L639">view source</a></div></div><div class="public anchor" id="var-realtime-graph"><h3>realtime-graph</h3><div class="usage"><code>(realtime-graph history)</code></div><div class="doc"><div class="markdown"><p>Given a history, produces an singleton order graph <code>{:realtime graph}</code> which encodes the real-time dependencies of transactions: a &lt; b if a ends before b begins.</p>
<p>In general, txn a precedes EVERY txn which begins later in the history, but that’s n^2 territory, and for purposes of cycle detection, we only need a transitive reduction of that graph. We compute edges from txn a to subsequent invocations until a new operation b completes.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L475">view source</a></div></div><div class="public anchor" id="var-remove-relationship"><h3>remove-relationship</h3><div class="usage"><code>(remove-relationship g rel)</code></div><div class="doc"><div class="markdown"><p>Filters a graph, removing the given relationship from it.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L204">view source</a></div></div><div class="public anchor" id="var-renumber-graph"><h3>renumber-graph</h3><div class="usage"><code>(renumber-graph g)</code></div><div class="doc"><div class="markdown"><p>Takes a Graph and rewrites each vertex to a unique integer, returning the rewritten Graph, and a vector of the original vertexes for reconstruction.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L678">view source</a></div></div><div class="public anchor" id="var-strongly-connected-components"><h3>strongly-connected-components</h3><div class="usage"><code>(strongly-connected-components g)</code></div><div class="doc"><div class="markdown"><p>Finds the strongly connected components of a graph, greater than 1 element.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L252">view source</a></div></div><div class="public anchor" id="var-tarjan"><h3>tarjan</h3><div class="usage"><code>(tarjan graph)</code></div><div class="doc"><div class="markdown"><p>Returns the strongly connected components of a graph specified by its nodes (ints) and a successor function (succs node) from node to nodes. A iterative verison of Tarjan’s Strongly Connected Components.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L257">view source</a></div></div><div class="public anchor" id="var-ToClj"><h3>ToClj</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var--.3Eclj"><h3>-&gt;clj</h3><div class="usage"><code>(-&gt;clj x)</code></div><div class="doc"><div class="markdown"></div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L61">view source</a></div></div><div class="public anchor" id="var-union-edge"><h3>union-edge</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A binary operator performing set union on the values of edges.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L121">view source</a></div></div><div class="public anchor" id="var-unlink"><h3>unlink</h3><div class="usage"><code>(unlink g a b)</code></div><div class="doc"><div class="markdown"><p>Heper for unlinking Bifurcan graphs.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L181">view source</a></div></div><div class="public anchor" id="var-wr-graph"><h3>wr-graph</h3><div class="usage"><code>(wr-graph history)</code></div><div class="doc"><div class="markdown"><p>Given a history where ops are txns (e.g. <a href="null">:r :x 2] [:w :y 3</a>), constructs an order over txns based on the external writes and reads of key k: any txn that reads value v must come after the txn that wrote v.</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L581">view source</a></div></div><div class="public anchor" id="var-write-cycles.21"><h3>write-cycles!</h3><div class="usage"><code>(write-cycles! test opts cycles)</code></div><div class="doc"><div class="markdown"><p>Writes cycles to a file. Opts:</p>
<p>:subdirectory What subdirectory to write to :filename What to call the file</p></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/0.1.17/jepsen/src/jepsen/tests/cycle.clj#L873">view source</a></div></div></div></body></html>